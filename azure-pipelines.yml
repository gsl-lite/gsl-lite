
trigger:
- master
- mr/*

pr:
- master

resources:
  repositories:
    - repository: templates
      type: github
      name: mbeutel/CImakeshift
      endpoint: mbeutel
      #ref: refs/tags/0.2

jobs:
- template: azure-pipelines-job-cmake.yml@templates
  parameters:
    cache: False
    #vcpkgRef: bc01338fe2d50f4a24b7f56b53bc385d8de8ccd9
    #vcpkgPackages: ['catch2'] # to make sure we actually use Vcpkg
    cmakeConfigArgs: '-DGSL_LITE_OPT_BUILD_TESTS=ON -DGSL_LITE_OPT_BUILD_EXAMPLES=ON'
    cmakeTestArgs: '--exclude-regex "cuda"' # do not run CUDA tests

    targets:

    #- os: Linux
    #  cxxCompiler: GCC
    #  cxxCompilerVersions: [5, 6, 7, 8]
    #  platforms: [x64]

    #- os: Linux
    #  cxxCompiler: GCC
    #  cxxCompilerVersions: [9]
    #  platforms: [x64]
    #  tag: 'sanitize'
    #  cmakeBuildConfigurations: [Debug]
    #  cmakeConfigArgs: '-DGSL_LITE_OPT_BUILD_TESTS=ON -DCMAKE_CXX_FLAGS="$CXXFLAGS -fsanitize=address -fsanitize=undefined"'
    #  cmakeBuildArgs: '--target gsl-lite-cpplatest.t gsl-lite-altcfg-cpplatest.t'
    #  cmakeTestArgs: '--tests-regex "gsl-lite-cpplatest\.t|gsl-lite-altcfg-cpplatest\.t"'

    #- os: Linux
    #  cxxCompiler: Clang
    #  cxxCompilerVersions: [4, 5, 6, 7, 8]
    #  platforms: [x64]

    - os: Linux
      cxxCompiler: Clang
      cxxCompilerVersions: [9]
      platforms: [x64]
      tag: 'sanitize'
      cmakeBuildConfigurations: [Debug]
      cmakeConfigArgs: '-DGSL_LITE_OPT_BUILD_TESTS=ON -DCMAKE_CXX_FLAGS="$CXXFLAGS -fsanitize=address -fsanitize=undefined"'
      cmakeBuildArgs: '--target gsl-lite-cpplatest.t gsl-lite-altcfg-cpplatest.t'
      cmakeTestArgs: '--tests-regex "gsl-lite-cpplatest\.t|gsl-lite-altcfg-cpplatest\.t"'

    #- os: Linux
    #  cxxCompiler: GCC
    #  cxxCompilerVersions: [9]
    #  cudaCompiler: NVCC
    #  cudaCompilerVersion: 10_2
    #  platforms: [x64]
    #  cmakeConfigArgs: '-DGSL_LITE_OPT_BUILD_CUDA_TESTS=ON'

    #- os: Windows
    #  cxxCompiler: MSVC
    #  cxxCompilerVersions: [19_1, 19_2]
    #  cmakeGenerator: 'MSBuild' # required for CppCoreCheck
    #  platforms: [x86, x64]
    - os: Windows
      cxxCompiler: MSVC
      cxxCompilerVersions: [19_2]
      platforms: [x64]

    - os: Windows
      cxxCompiler: Clang
      cxxCompilerVersions: [9]
      cmakeBuildConfigurations: [Debug]
      platforms: [x86, x64]

    - os: Windows
      cxxCompiler: MSVC
      cxxCompilerVersions: [19_2]
      cudaCompiler: NVCC
      cudaCompilerVersion: 10_2
      platforms: [x64]
      cmakeConfigArgs: '-DGSL_LITE_OPT_BUILD_CUDA_TESTS=ON'

    #- os: MacOS
    #  cxxCompiler: GCC
    #  cxxCompilerVersions: [6, 7, 8, 9]
    #  platforms: [x64]

    #- os: MacOS
    #  cxxCompiler: AppleClang
    #  cxxCompilerVersions: [8_1, 9, 9_1, 10, 10_0_1, 11]
    #  platforms: [x64]
